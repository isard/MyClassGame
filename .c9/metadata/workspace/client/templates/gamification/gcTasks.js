{"filter":false,"title":"gcTasks.js","tooltip":"/client/templates/gamification/gcTasks.js","undoManager":{"mark":30,"position":30,"stack":[[{"start":{"row":1,"column":1},"end":{"row":1,"column":2},"action":"remove","lines":["*"],"id":2}],[{"start":{"row":1,"column":0},"end":{"row":1,"column":1},"action":"remove","lines":["/"],"id":3}],[{"start":{"row":211,"column":1},"end":{"row":211,"column":2},"action":"remove","lines":["/"],"id":4}],[{"start":{"row":211,"column":0},"end":{"row":211,"column":1},"action":"remove","lines":["*"],"id":5}],[{"start":{"row":217,"column":3},"end":{"row":217,"column":4},"action":"remove","lines":["/"],"id":6}],[{"start":{"row":217,"column":2},"end":{"row":217,"column":3},"action":"remove","lines":["/"],"id":7}],[{"start":{"row":37,"column":4},"end":{"row":37,"column":15},"action":"remove","lines":["//creaTarea"],"id":8},{"start":{"row":37,"column":4},"end":{"row":37,"column":15},"action":"insert","lines":["listaTareas"]}],[{"start":{"row":37,"column":4},"end":{"row":37,"column":5},"action":"insert","lines":["L"],"id":9}],[{"start":{"row":37,"column":5},"end":{"row":37,"column":6},"action":"remove","lines":["l"],"id":10}],[{"start":{"row":37,"column":9},"end":{"row":37,"column":10},"action":"insert","lines":["C"],"id":11}],[{"start":{"row":37,"column":10},"end":{"row":37,"column":11},"action":"insert","lines":["u"],"id":12}],[{"start":{"row":37,"column":11},"end":{"row":37,"column":12},"action":"insert","lines":["r"],"id":13}],[{"start":{"row":37,"column":12},"end":{"row":37,"column":13},"action":"insert","lines":["s"],"id":14}],[{"start":{"row":37,"column":13},"end":{"row":37,"column":14},"action":"insert","lines":["o"],"id":15}],[{"start":{"row":37,"column":14},"end":{"row":37,"column":15},"action":"insert","lines":["s"],"id":16}],[{"start":{"row":37,"column":15},"end":{"row":37,"column":16},"action":"remove","lines":["T"],"id":17}],[{"start":{"row":37,"column":15},"end":{"row":37,"column":16},"action":"remove","lines":["a"],"id":18}],[{"start":{"row":37,"column":15},"end":{"row":37,"column":16},"action":"remove","lines":["r"],"id":19}],[{"start":{"row":37,"column":15},"end":{"row":37,"column":16},"action":"remove","lines":["e"],"id":20}],[{"start":{"row":37,"column":15},"end":{"row":37,"column":16},"action":"remove","lines":["a"],"id":21}],[{"start":{"row":37,"column":15},"end":{"row":37,"column":16},"action":"remove","lines":["s"],"id":22}],[{"start":{"row":2,"column":0},"end":{"row":210,"column":1},"action":"remove","lines":["// Client ID and API key from the Developer Console","  ","var CLIENT_ID = '422269930750-src3psqemmt1p6m8alujf9nvmook5c0d.apps.googleusercontent.com';","var API_KEY = 'AIzaSyBqyxpnFhDv1nOkTszttyDSXn2HPpznhZI';","","// Cargamos el servicio Rest API de Google ","//var DISCOVERY_DOCS = [\"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\"];","var DISCOVERY_DOCS = [\"https://www.googleapis.com/discovery/v1/apis/classroom/v1/rest\",\"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\"];","","// El servicio de Autenticaci칩n con una cuenta de Google ","//var SCOPES = 'https://www.googleapis.com/auth/drive.metadata.readonly';","var SCOPES = \"https://www.googleapis.com/auth/drive.metadata.readonly https://www.googleapis.com/auth/classroom.courses.readonly https://www.googleapis.com/auth/classroom.rosters.readonly https://www.googleapis.com/auth/classroom.profile.emails https://www.googleapis.com/auth/classroom.coursework.students.readonly https://www.googleapis.com/auth/classroom.coursework.students\";","","// Seleccionamos los botones de Iniciar Sesi칩n y Cerrar Sesi칩n ","","function handleClientLoad() {","  gapi.load('client:auth2', initClient);","}","","function initClient() {","  gapi.client.init({","    apiKey: API_KEY,","    clientId: CLIENT_ID,","    discoveryDocs: DISCOVERY_DOCS,","    scope: SCOPES","  }).then(function () {","    ","    gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);","","    updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());","  });","}","","function updateSigninStatus(isSignedIn) {","  if (isSignedIn) {","    ListaCursos();","  } else {","    gapi.auth2.getAuthInstance().signIn();","  }","}","","function appendPre(message) {","  $(\"#GoogleClassroom\").html($(\"#GoogleClassroom\").html() + message + '\\n');","}","","// Ac치 listamos los archivos de nuestra cuenta de Google Drive, especificamos que datos de los archivos queremos mostrar ","","function listFolder() {","  //Llistar carpeta","  gapi.client.drive.files.list({","    'pageSize': 10,","    'fields': \"nextPageToken, files(id, name)\"","  }).then(function(response) {","    appendPre('Files:');","    var files = response.result.files;","    if (files && files.length > 0) {","      for (var i = 0; i < files.length; i++) {","        var file = files[i];","        appendPre(file.name + ' (' + file.id + ')');","      }","    } else {","      appendPre('No files found.');","    }","  });","}","","function createFolderFunction() {","  //Crear carpeta","  var body= {\"name\": \"tururi\", ","     \"mimeType\": \"application/vnd.google-apps.folder\"}","  ","  gapi.client.request({","    'path': 'https://www.googleapis.com/drive/v3/files/',","    'method': 'POST',","    'body': body","  }).then(function(jsonResp,rawResp) {","      console.log(jsonResp);","      changePermissions(jsonResp.result.id)","      if (jsonResp.status==200) {","        callback(jsonResp.result)","      }","  })","}","","function changePermissions(folderId) {","  //Canviar permissos","  var body = {","  'withLink': true,","  'type': \"anyone\",","  'role': \"reader\"","  };","  gapi.client.request({","    'path': 'https://www.googleapis.com/drive/v3/files/'+folderId+'/permissions',","    'method': 'POST',","    'body': body","  }).then(function(jsonResp,rawResp) {","      console.log(jsonResp)","      if (jsonResp.status==200) {","        callback(jsonResp.result)","      }","  })","  ","  ","  gapi.client.drive.permissions.insert({","  'fileId': files,","  'resource': body","  }).execute(function(response) {","  callback(null, response);","  });","}","","function listCourses() {","  gapi.client.classroom.courses.list({","    pageSize: 10,","  }).then(function(response) {","    var courses = response.result.courses;","    appendPre('Courses:');","    if (courses.length > 0) {","      for (i = 0; i < courses.length; i++) {","        var course = courses[i];","        appendPre(course.name+\":\"+course.id)","        listStudents(course.id);","      }","    } else {","      appendPre('No courses found.');","    }","  });","}","  ","function listStudents(c) {","  gapi.client.classroom.courses.students.list({","    courseId: c","  }).then(function(response) {","    var students = response.result.students;","    appendPre('students:');","    if (students.length > 0) {","      for (i = 0; i < students.length; i++) {","        var student = students[i];","        appendPre(c+\":\"+student.userId+\":\"+student.profile.name.fullName)","      }","    } else {","      appendPre('No students found.');","    }","  });","}","","function ListaCursos() {","  gapi.client.classroom.courses.list({","    pageSize: 10,","  }).then(function(response) {","    Session.set('lc',response.result.courses);","    var courses = response.result.courses;","    if (courses.length > 0) {","      for (i = 0; i < courses.length; i++) {","        var course = courses[i];","        ListaEstudiantes(course.id);","      }","    } else {","      appendPre('No courses found.');","    }","  });","}","","function ListaEstudiantes(c) {","  gapi.client.classroom.courses.students.list({","    courseId: c","  }).then(function(response) {","    Session.set('sc'+c,response.result.students);","  });","}","","function listaTareas() {","  gapi.client.classroom.courses.courseWork.list({","    courseId: '36588540955'","  }).then(function(response) {","    console.log(response.result);","    Session.set('lt',response.result.courseWork);","  });","}","","function creaTarea() {","  cW = {","    'title': 'Filomeno',","    'description': 'Read the article about ant colonies and complete the quiz.',","    'materials': [","       {'link': { 'url': 'http://example.com/ant-colonies' }},","       {'link': { 'url': 'http://example.com/ant-quiz' }}","  ],","    'workType': 'ASSIGNMENT',","    'state': 'PUBLISHED',","  }","  courseId=classes.findOne({'_id':Session.get('classId')}).gcId;","  gapi.client.request({","    'path': 'https://classroom.googleapis.com/v1/courses/'+courseId+'/courseWork',","    'method': 'POST',","    'body': cW","  }).then(function(jsonResp,rawResp) {","      console.log(jsonResp)","      if (jsonResp.status==200) {","        callback(jsonResp.result)","      }","  })","  gapi.client.classroom.courses.courseWork.create({","      'courseId': '36588540955',","      'body':cW","    }).then(function(response) {","    console.log(response);","  });","}"],"id":23}],[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"remove","lines":["",""],"id":24}],[{"start":{"row":0,"column":30},"end":{"row":1,"column":0},"action":"remove","lines":["",""],"id":25}],[{"start":{"row":0,"column":30},"end":{"row":1,"column":0},"action":"remove","lines":["",""],"id":26}],[{"start":{"row":6,"column":21},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":27},{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":7,"column":2},"end":{"row":7,"column":16},"action":"insert","lines":["listaTareas();"],"id":28}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":21},"action":"remove","lines":["  handleClientLoad();"],"id":29}],[{"start":{"row":5,"column":56},"end":{"row":6,"column":0},"action":"remove","lines":["",""],"id":30}],[{"start":{"row":4,"column":0},"end":{"row":5,"column":56},"action":"remove","lines":["  $.getScript(\"https://apis.google.com/js/api.js\");","  $.getScript(\"https://apis.google.com/js/platform.js\");"],"id":31}],[{"start":{"row":3,"column":25},"end":{"row":4,"column":0},"action":"remove","lines":["",""],"id":32}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":3,"column":25},"end":{"row":3,"column":25},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1557403278354,"hash":"3349f7bdf088dfe05af98eb4813e20634eb57758"}